<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Confirma√ß√µes de Entrega</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        header p {
            color: #888;
            font-size: 1.1rem;
        }
        
        .upload-area {
            background: rgba(255,255,255,0.05);
            border: 2px dashed #667eea;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
        }
        
        .upload-area.dragover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        
        #fileInput {
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.green { border-left: 4px solid #4ade80; }
        .stat-card.red { border-left: 4px solid #f87171; }
        .stat-card.yellow { border-left: 4px solid #fbbf24; }
        .stat-card.blue { border-left: 4px solid #60a5fa; }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #888;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .chart-card h3 {
            margin-bottom: 20px;
            color: #667eea;
            font-size: 1.2rem;
        }
        
        .brand-filter {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .brand-filter h3 {
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .brand-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .brand-btn {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid #667eea;
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .brand-btn:hover, .brand-btn.active {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
        }
        
        .brand-dashboard {
            display: none;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .brand-dashboard.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .brand-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .brand-header h2 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .brand-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .brand-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .brand-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .brand-stat-label {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            display: flex;
            margin-bottom: 20px;
        }
        
        .progress-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            transition: width 0.5s ease;
        }
        
        .progress-segment.green { background: #4ade80; color: #000; }
        .progress-segment.red { background: #f87171; color: #000; }
        .progress-segment.yellow { background: #fbbf24; color: #000; }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        th {
            background: rgba(102, 126, 234, 0.2);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-badge.reconheco { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .status-badge.nao-reconheco { background: rgba(248, 113, 113, 0.2); color: #f87171; }
        .status-badge.investigacao { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        
        .insights {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .insights h4 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .insight-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .insight-item:last-child {
            border-bottom: none;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .brand-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì¶ Dashboard de Confirma√ß√µes</h1>
            <p>An√°lise de entregas por marca - Powered by AI</p>
        </header>

        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">üìÅ</div>
            <h3>Arraste sua planilha aqui</h3>
            <p>ou clique para selecionar (.xlsx, .csv)</p>
            <input type="file" id="fileInput" accept=".xlsx,.csv">
        </div>

        <div id="dashboard" class="hidden">
            <!-- Stats Gerais -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card blue">
                    <div class="stat-value" id="totalRegistros">0</div>
                    <div class="stat-label">Total de Registros</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-value" id="totalReconheco">0</div>
                    <div class="stat-label">‚úÖ Reconhe√ßo</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-value" id="totalNaoReconheco">0</div>
                    <div class="stat-label">‚ùå N√£o Reconhe√ßo</div>
                </div>
                <div class="stat-card yellow">
                    <div class="stat-value" id="totalInvestigacao">0</div>
                    <div class="stat-label">üîç Investiga√ß√£o</div>
                </div>
            </div>

            <!-- Gr√°ficos Gerais -->
            <div class="charts-section">
                <div class="chart-card">
                    <h3>üìä Distribui√ß√£o Geral</h3>
                    <canvas id="chartGeral"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üìà Por Marca</h3>
                    <canvas id="chartMarcas"></canvas>
                </div>
            </div>

            <!-- Filtro por Marca -->
            <div class="brand-filter">
                <h3>üè∑Ô∏è Selecione uma Marca</h3>
                <div class="brand-buttons" id="brandButtons"></div>
            </div>

            <!-- Dashboard Individual por Marca -->
            <div class="brand-dashboard" id="brandDashboard">
                <div class="brand-header">
                    <h2 id="brandName">Marca</h2>
                    <span id="brandPeriod"></span>
                </div>
                
                <div class="brand-stats">
                    <div class="brand-stat">
                        <div class="brand-stat-value" id="brandTotal" style="color: #60a5fa;">0</div>
                        <div class="brand-stat-label">Total</div>
                    </div>
                    <div class="brand-stat">
                        <div class="brand-stat-value" id="brandReconheco" style="color: #4ade80;">0</div>
                        <div class="brand-stat-label">Reconhe√ßo</div>
                    </div>
                    <div class="brand-stat">
                        <div class="brand-stat-value" id="brandNaoReconheco" style="color: #f87171;">0</div>
                        <div class="brand-stat-label">N√£o Reconhe√ßo</div>
                    </div>
                    <div class="brand-stat">
                        <div class="brand-stat-value" id="brandInvestigacao" style="color: #fbbf24;">0</div>
                        <div class="brand-stat-label">Investiga√ß√£o</div>
                    </div>
                </div>

                <h4 style="margin-bottom: 10px; color: #888;">Taxa de Confirma√ß√£o</h4>
                <div class="progress-bar" id="brandProgress"></div>

                <div class="charts-section">
                    <div class="chart-card">
                        <h3>üìä Distribui√ß√£o da Marca</h3>
                        <canvas id="chartBrand"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>üìÖ Evolu√ß√£o Di√°ria</h3>
                        <canvas id="chartDaily"></canvas>
                    </div>
                </div>

                <div class="insights" id="brandInsights">
                    <h4>ü§ñ Insights IA</h4>
                    <div id="insightsList"></div>
                </div>

                <div class="table-container">
                    <h4 style="margin-bottom: 15px; color: #667eea;">üìã √öltimos Registros</h4>
                    <table id="brandTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Pedido</th>
                            </tr>
                        </thead>
                        <tbody id="brandTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let chartGeral = null;
        let chartMarcas = null;
        let chartBrand = null;
        let chartDaily = null;

        // Upload handlers
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) processFile(file);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) processFile(e.target.files[0]);
        });

        function processFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                allData = XLSX.utils.sheet_to_json(sheet);
                
                // Normalizar nomes das colunas
                allData = allData.map(row => {
                    const normalized = {};
                    Object.keys(row).forEach(key => {
                        const lowerKey = key.toLowerCase().trim();
                        if (lowerKey.includes('data')) normalized.data = row[key];
                        else if (lowerKey.includes('confirma')) normalized.confirmacao = row[key];
                        else if (lowerKey.includes('marca')) normalized.marca = row[key];
                        else if (lowerKey.includes('pedido') || lowerKey.includes('order')) normalized.pedido = row[key];
                    });
                    return normalized;
                });

                renderDashboard();
            };
            reader.readAsArrayBuffer(file);
        }

        function getStatus(confirmacao) {
            if (!confirmacao) return 'desconhecido';
            const c = confirmacao.toLowerCase();
            if (c.includes('sim') || c.includes('reconhe√ßo') || c.includes('encontrei') || c.includes('tudo certo')) {
                if (!c.includes('n√£o')) return 'reconheco';
            }
            if (c.includes('n√£o reconhe√ßo') || c.includes('nao reconheco')) return 'nao-reconheco';
            if (c.includes('investiga√ß√£o') || c.includes('investigacao')) return 'investigacao';
            return 'desconhecido';
        }

        function getStatusLabel(status) {
            switch(status) {
                case 'reconheco': return '‚úÖ Reconhe√ßo';
                case 'nao-reconheco': return '‚ùå N√£o Reconhe√ßo';
                case 'investigacao': return 'üîç Investiga√ß√£o';
                default: return '‚ùì Desconhecido';
            }
        }

        function renderDashboard() {
            document.getElementById('dashboard').classList.remove('hidden');
            uploadArea.style.display = 'none';

            // Calcular estat√≠sticas gerais
            const stats = {
                total: allData.length,
                reconheco: allData.filter(d => getStatus(d.confirmacao) === 'reconheco').length,
                naoReconheco: allData.filter(d => getStatus(d.confirmacao) === 'nao-reconheco').length,
                investigacao: allData.filter(d => getStatus(d.confirmacao) === 'investigacao').length
            };

            document.getElementById('totalRegistros').textContent = stats.total;
            document.getElementById('totalReconheco').textContent = stats.reconheco;
            document.getElementById('totalNaoReconheco').textContent = stats.naoReconheco;
            document.getElementById('totalInvestigacao').textContent = stats.investigacao;

            // Gr√°fico Geral (Pizza)
            if (chartGeral) chartGeral.destroy();
            chartGeral = new Chart(document.getElementById('chartGeral'), {
                type: 'doughnut',
                data: {
                    labels: ['Reconhe√ßo', 'N√£o Reconhe√ßo', 'Investiga√ß√£o'],
                    datasets: [{
                        data: [stats.reconheco, stats.naoReconheco, stats.investigacao],
                        backgroundColor: ['#4ade80', '#f87171', '#fbbf24'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#fff' }
                        }
                    }
                }
            });

            // Agrupar por marca
            const marcas = {};
            allData.forEach(d => {
                const marca = d.marca || 'Sem Marca';
                if (!marcas[marca]) {
                    marcas[marca] = { total: 0, reconheco: 0, naoReconheco: 0, investigacao: 0 };
                }
                marcas[marca].total++;
                const status = getStatus(d.confirmacao);
                if (status === 'reconheco') marcas[marca].reconheco++;
                else if (status === 'nao-reconheco') marcas[marca].naoReconheco++;
                else if (status === 'investigacao') marcas[marca].investigacao++;
            });

            // Gr√°fico por Marca (Barras empilhadas)
            const marcaNames = Object.keys(marcas).filter(m => m !== 'Sem Marca' && m.trim() !== '');
            if (chartMarcas) chartMarcas.destroy();
            chartMarcas = new Chart(document.getElementById('chartMarcas'), {
                type: 'bar',
                data: {
                    labels: marcaNames.length > 0 ? marcaNames : ['Todas'],
                    datasets: [
                        {
                            label: 'Reconhe√ßo',
                            data: marcaNames.length > 0 ? marcaNames.map(m => marcas[m].reconheco) : [stats.reconheco],
                            backgroundColor: '#4ade80'
                        },
                        {
                            label: 'N√£o Reconhe√ßo',
                            data: marcaNames.length > 0 ? marcaNames.map(m => marcas[m].naoReconheco) : [stats.naoReconheco],
                            backgroundColor: '#f87171'
                        },
                        {
                            label: 'Investiga√ß√£o',
                            data: marcaNames.length > 0 ? marcaNames.map(m => marcas[m].investigacao) : [stats.investigacao],
                            backgroundColor: '#fbbf24'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { stacked: true, ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { stacked: true, ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#fff' }
                        }
                    }
                }
            });

            // Bot√µes de marca
            const brandButtons = document.getElementById('brandButtons');
            brandButtons.innerHTML = '';
            
            const allBrandsBtn = document.createElement('button');
            allBrandsBtn.className = 'brand-btn active';
            allBrandsBtn.textContent = 'üåê Todas';
            allBrandsBtn.onclick = () => showBrandDashboard(null);
            brandButtons.appendChild(allBrandsBtn);

            marcaNames.forEach(marca => {
                const btn = document.createElement('button');
                btn.className = 'brand-btn';
                btn.textContent = marca;
                btn.onclick = () => showBrandDashboard(marca);
                brandButtons.appendChild(btn);
            });
        }

        function showBrandDashboard(marca) {
            // Update active button
            document.querySelectorAll('.brand-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const dashboard = document.getElementById('brandDashboard');
            dashboard.classList.add('visible');

            const filteredData = marca ? allData.filter(d => d.marca === marca) : allData;
            
            const stats = {
                total: filteredData.length,
                reconheco: filteredData.filter(d => getStatus(d.confirmacao) === 'reconheco').length,
                naoReconheco: filteredData.filter(d => getStatus(d.confirmacao) === 'nao-reconheco').length,
                investigacao: filteredData.filter(d => getStatus(d.confirmacao) === 'investigacao').length
            };

            document.getElementById('brandName').textContent = marca || 'üåê Todas as Marcas';
            document.getElementById('brandTotal').textContent = stats.total;
            document.getElementById('brandReconheco').textContent = stats.reconheco;
            document.getElementById('brandNaoReconheco').textContent = stats.naoReconheco;
            document.getElementById('brandInvestigacao').textContent = stats.investigacao;

            // Progress bar
            const progressBar = document.getElementById('brandProgress');
            const pctReconheco = ((stats.reconheco / stats.total) * 100).toFixed(1);
            const pctNaoReconheco = ((stats.naoReconheco / stats.total) * 100).toFixed(1);
            const pctInvestigacao = ((stats.investigacao / stats.total) * 100).toFixed(1);
            
            progressBar.innerHTML = `
                <div class="progress-segment green" style="width: ${pctReconheco}%">${pctReconheco}%</div>
                <div class="progress-segment red" style="width: ${pctNaoReconheco}%">${pctNaoReconheco}%</div>
                <div class="progress-segment yellow" style="width: ${pctInvestigacao}%">${pctInvestigacao}%</div>
            `;

            // Gr√°fico da marca (Pizza)
            if (chartBrand) chartBrand.destroy();
            chartBrand = new Chart(document.getElementById('chartBrand'), {
                type: 'pie',
                data: {
                    labels: ['Reconhe√ßo', 'N√£o Reconhe√ßo', 'Investiga√ß√£o'],
                    datasets: [{
                        data: [stats.reconheco, stats.naoReconheco, stats.investigacao],
                        backgroundColor: ['#4ade80', '#f87171', '#fbbf24'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#fff' }
                        }
                    }
                }
            });

            // Gr√°fico di√°rio
            const dailyStats = {};
            filteredData.forEach(d => {
                const data = d.data || 'Sem Data';
                if (!dailyStats[data]) {
                    dailyStats[data] = { reconheco: 0, naoReconheco: 0, investigacao: 0 };
                }
                const status = getStatus(d.confirmacao);
                if (status === 'reconheco') dailyStats[data].reconheco++;
                else if (status === 'nao-reconheco') dailyStats[data].naoReconheco++;
                else if (status === 'investigacao') dailyStats[data].investigacao++;
            });

            const sortedDates = Object.keys(dailyStats).sort((a, b) => {
                const [dA, mA, yA] = a.split('/');
                const [dB, mB, yB] = b.split('/');
                return new Date(yA, mA-1, dA) - new Date(yB, mB-1, dB);
            });

            if (chartDaily) chartDaily.destroy();
            chartDaily = new Chart(document.getElementById('chartDaily'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [
                        {
                            label: 'Reconhe√ßo',
                            data: sortedDates.map(d => dailyStats[d].reconheco),
                            borderColor: '#4ade80',
                            backgroundColor: 'rgba(74, 222, 128, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'N√£o Reconhe√ßo',
                            data: sortedDates.map(d => dailyStats[d].naoReconheco),
                            borderColor: '#f87171',
                            backgroundColor: 'rgba(248, 113, 113, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Investiga√ß√£o',
                            data: sortedDates.map(d => dailyStats[d].investigacao),
                            borderColor: '#fbbf24',
                            backgroundColor: 'rgba(251, 191, 36, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#fff' }
                        }
                    }
                }
            });

            // Insights IA
            generateInsights(marca, stats, filteredData);

            // Tabela de registros
            const tbody = document.getElementById('brandTableBody');
            tbody.innerHTML = '';
            filteredData.slice(0, 20).forEach(d => {
                const status = getStatus(d.confirmacao);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${d.data || '-'}</td>
                    <td><span class="status-badge ${status}">${getStatusLabel(status)}</span></td>
                    <td>${d.pedido || '-'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function generateInsights(marca, stats, data) {
            const insightsList = document.getElementById('insightsList');
            const insights = [];
            
            const taxaReconhecimento = ((stats.reconheco / stats.total) * 100).toFixed(1);
            const taxaProblema = (((stats.naoReconheco + stats.investigacao) / stats.total) * 100).toFixed(1);

            // Insight principal
            if (taxaReconhecimento >= 70) {
                insights.push({
                    icon: '‚úÖ',
                    text: `Excelente! Taxa de reconhecimento de ${taxaReconhecimento}% est√° acima da m√©dia.`
                });
            } else if (taxaReconhecimento >= 50) {
                insights.push({
                    icon: '‚ö†Ô∏è',
                    text: `Aten√ß√£o: Taxa de reconhecimento de ${taxaReconhecimento}% pode ser melhorada.`
                });
            } else {
                insights.push({
                    icon: 'üö®',
                    text: `Cr√≠tico: Apenas ${taxaReconhecimento}% de reconhecimento. Verificar processo de entrega.`
                });
            }

            // Insight sobre investiga√ß√µes
            if (stats.investigacao > stats.total * 0.2) {
                insights.push({
                    icon: 'üîç',
                    text: `${stats.investigacao} casos em investiga√ß√£o (${((stats.investigacao/stats.total)*100).toFixed(1)}%). Acompanhar resolu√ß√£o.`
                });
            }

            // Insight sobre n√£o reconhecimento
            if (stats.naoReconheco > stats.total * 0.3) {
                insights.push({
                    icon: '‚ùå',
                    text: `Alto √≠ndice de n√£o reconhecimento (${((stats.naoReconheco/stats.total)*100).toFixed(1)}%). Sugest√£o: revisar comprovantes de entrega.`
                });
            }

            // Sugest√£o de a√ß√£o
            if (taxaProblema > 30) {
                insights.push({
                    icon: 'üí°',
                    text: `Recomenda√ß√£o: Implementar foto obrigat√≥ria na entrega para reduzir contesta√ß√µes.`
                });
            }

            // Tend√™ncia (se houver dados suficientes)
            if (data.length > 10) {
                const metade = Math.floor(data.length / 2);
                const primeiraMetade = data.slice(metade);
                const segundaMetade = data.slice(0, metade);
                
                const taxaPrimeira = primeiraMetade.filter(d => getStatus(d.confirmacao) === 'reconheco').length / primeiraMetade.length;
                const taxaSegunda = segundaMetade.filter(d => getStatus(d.confirmacao) === 'reconheco').length / segundaMetade.length;
                
                if (taxaSegunda > taxaPrimeira + 0.1) {
                    insights.push({
                        icon: 'üìà',
                        text: `Tend√™ncia positiva: Taxa de reconhecimento melhorou nos √∫ltimos registros.`
                    });
                } else if (taxaSegunda < taxaPrimeira - 0.1) {
                    insights.push({
                        icon: 'üìâ',
                        text: `Aten√ß√£o: Taxa de reconhecimento piorou recentemente. Investigar causa.`
                    });
                }
            }

            insightsList.innerHTML = insights.map(i => `
                <div class="insight-item">
                    <span>${i.icon}</span>
                    <span>${i.text}</span>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
